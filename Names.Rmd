---
title: "Names"
output: html_document
---



```{r setup, include=FALSE, fig.show = "asis"}
library(CMcCode)
library(data.table)
library(htmlTable)
library(ggplot2)
library(grid)
library(gridExtra)
library(rjson)

A <- 5436233949473;
B <- 531168942173;
M <- 6357638997713;
maxrow <- 10
maxcol <- 10
maxSeed <- 10000000

```

```{r, echo = FALSE, results = 'asis'}
words <- read.csv("Wordlist.csv", stringsAsFactors = F)
wordlists <- lapply(words, function(x) unique(x[x != ""]))
names(wordlists) <- c("orig", "duet", "more", "both", "all")
cat(paste0("<script>\nwordlists = ", toJSON(wordlists), "\n</script>"))

values <- data.table(Label = factor(c("A", 2:10, "J", "Q", "K"), levels = c("A", 2:10, "J", "Q", "K")),
                     Value = 0:12,
                     Val_Symbol1 = paste0("&#x24", c("B6", 61:69, "BF", "C6", "C0"), ";"),
                     # Val_Symbol2 = paste0("&#x", c("0041", paste0("00", 32:39), "2491", "004A", "005B", "004B"), ";") )
                     Val_Symbol2 = paste0("&#x", c("0041", 2489, "248A", "248B", "248C", "248D", "248E",
                                                   "248F", "2490", "2491", "004A", "0051", "004B"), ";") )
suits <- data.table(Suit = c("Heart", "Diamond", "Spade", "Club"), Suit_Symbol = c("&hearts;", "&diams;", "&spades;", "&clubs;"))
cards <- data.table(expand.grid(Value = 0:12, Suit = suits$Suit))
cards <- merge(merge(cards, values, by = "Value"), suits, by = "Suit")
cards$Name <- paste0(cards$Label, cards$Suit_Symbol)

cards2 <- data.frame(t(cards))
row.names(cards2) <- names(cards)
cat(paste0("<script>\ncard_list = ", toJSON(cards2), ";\n</script>"))

# htmlTable(cards, align = "r", row.names = F)
```

<script>
var wrd_nums = [];
var col_nums = [];
var crd_nums = [];
var col_list = [];
var A = `r as.character(A)`;
var B = `r as.character(B)`;
var M = `r as.character(M)`;
var maxrow = `r maxrow`, maxcol = `r maxcol`, maxSeed = `r as.character(maxSeed)`;

function newGrid () {
  document.getElementById("seed").value = Math.floor(Math.random()*maxSeed);
  genGrid();
}

function genGrid () {
  console.log("In");
  var rows = parseInt(document.getElementById("rw").value);
  var cols = parseInt(document.getElementById("cl").value);
  var size = parseInt(document.getElementById("sz").value);
  var seed = parseInt(document.getElementById("seed").value);
  
  // Random numbers for words
  wrd_nums[0] = (A*seed + B) % M;
  wrd_nums[0] = (A*wrd_nums[0] + B) % M;
  for (var i = 1; i < wordlists[wrdlist.value].length; i++) {
    wrd_nums[i] = (A*wrd_nums[i-1] + B) % M;
    wrd_nums[i-1] = wrd_nums[i-1] / M
  }
  wrd_nums[wrd_nums.length-1] = wrd_nums[wrd_nums.length-1] / M
  
  // Random numbers for colors
  col_nums[0] = (A*wrd_nums[wrd_nums.length-1] + B) % M;
  col_nums[0] = (A*col_nums[0] + B) % M;
  for (var i = 1; i < size; i++) {
    col_nums[i] = (A*col_nums[i-1] + B) % M;
    col_nums[i-1] = col_nums[i-1] / M
  }
  col_nums[col_nums.length-1] = col_nums[col_nums.length-1] / M
  
  // Random numbers for cards
  crd_nums[0] = (A*col_nums[col_nums.length-1] + B) % M;
  crd_nums[0] = (A*crd_nums[0] + B) % M;
  for (var i = 1; i < size; i++) {
    crd_nums[i] = (A*crd_nums[i-1] + B) % M;
    crd_nums[i-1] = crd_nums[i-1] / M
  }
  crd_nums[col_nums.length-1] = col_nums[col_nums.length-1] / M
  
  // Sample words
  var k = 0;
  for(var i = 0; i < maxrow; i++) {
    for(var j = 0; j < maxcol; j++) {
      if(i < rows && j < cols) {
        document.getElementById("agnt_" + (i+1) + "_" + (j+1)).innerHTML = wordlists[wrdlist.value][getRank(wrd_nums, k)-1];
        document.getElementById("key_" + (i+1) + "_" + (j+1)).innerHTML = wordlists[wrdlist.value][getRank(wrd_nums, k)-1];
        k++;
      } else {
        document.getElementById("agnt_" + (i+1) + "_" + (j+1)).innerHTML = "";
        document.getElementById("key_" + (i+1) + "_" + (j+1)).innerHTML = "";
      }
    }
  }
  
  // Sample colors
  k = 0;
  for(var i = 0; i < rows; i++) {
    for(var j = 0; j < cols; j++) {
      document.getElementById("key_" + (i+1) + "_" + (j+1)).style.color = "black";
      document.getElementById("key_" + (i+1) + "_" + (j+1)).style.background = "#EEEACE";
      document.getElementById("key_" + (i+1) + "_" + (j+1)).style.background = col_list[getRank(col_nums, k)-1];
      if(col_list[getRank(col_nums, k)-1] == "black")
        document.getElementById("key_" + (i+1) + "_" + (j+1)).style.color = "white";
      k++;
    }
  }
  
  // Sample cards
  k = 0;
  for(var i = 0; i < rows; i++) {
    for(var j = 0; j < cols; j++) {
      document.getElementById("crd_" + (i+1) + "_" + (j+1)).value = crd_list[getRank(col_nums, k)-1];
      if(col_list[getRank(col_nums, k)-1] == "black")
        document.getElementById("key_" + (i+1) + "_" + (j+1)).style.color = "white";
      k++;
    }
  }
}
function getRank (vec, ind) {
  var sum = 1;
  for (var i = 0; i < vec.length; i++) {
    if(vec[ind] > vec[i])
      sum++;
  }
  return sum;
}
function checkSettings () {
  if(parseInt(rw.value) < 0) rw.value = 0;
  if(parseInt(rw.value) > maxrow) rw.value = maxrow;
  if(parseInt(cl.value) < 0) cl.value = 0;
  if(parseInt(cl.value) > maxcol)cl.value = maxcol;
  // Calculate number of words
  sz.value = parseInt(rw.value) * parseInt(cl.value);
  
  // Restrict number of agents according to number of words
  if(parseInt(rd.value) < 0) rd.value = 0;
  if(parseInt(rd.value) > parseInt(sz.value))
    rd.value = parseInt(sz.value);
  if(parseInt(bu.value) < 0) bu.value = 0;
  if(parseInt(bu.value) > parseInt(sz.value) - parseInt(rd.value)) 
    bu.value = sz.value - rd.value;
  if(parseInt(gr.value) < 0) gr.value = 0;
  if(parseInt(gr.value) > parseInt(sz.value) - parseInt(rd.value) - parseInt(bu.value))  
    gr.value = parseInt(sz.value) - parseInt(rd.value) - parseInt(bu.value);
  if(parseInt(ye.value) < 0) ye.value = 0;
  if(parseInt(ye.value) > parseInt(sz.value) - parseInt(rd.value) - parseInt(bu.value) - parseInt(gr.value))
    ye.value = parseInt(sz.value) - parseInt(rd.value) - parseInt(bu.value) - parseInt(gr.value);
  if(parseInt(as.value) < 0) 
    as.value = 0;
  if(parseInt(as.value) > parseInt(sz.value)-parseInt(rd.value)-parseInt(bu.value)-parseInt(gr.value)-parseInt(ye.value))
    as.value = parseInt(sz.value) - parseInt(rd.value) - parseInt(bu.value) - parseInt(gr.value) - parseInt(ye.value);
  
  // Create color list
  var k=0;
  for(var i=0; i < rd.valueAsNumber; i++, k++)
    col_list[k] = "red";
  for(var i=0; i < bu.valueAsNumber; i++, k++)
    col_list[k] = "blue";
  for(var i=0; i < gr.valueAsNumber; i++, k++)
    col_list[k] = "#00E000";
  for(var i=0; i < ye.valueAsNumber; i++, k++)
    col_list[k] = "yellow";
  for(var i=0; i < as.valueAsNumber; i++, k++)
    col_list[k] = "black";
  
  
  // Change table widths
  for (var i = 0; i < cl.valueAsNumber; i++) {
    agnt_tab.rows[0].cells[i].width = Math.round(100/cl.valueAsNumber) + "%";
    key_tab.rows[0].cells[i].width = Math.round(100/cl.valueAsNumber) + "%";
  }
  
  newGrid();
}
</script>

<input id = "seed" type = "number" onchange = "genGrid()")></input><br><button onclick = "newGrid()">New Grid</button>


# {.tabset .tabset-pills}

## Agents

```{r, echo = FALSE, results = 'asis'}
agent_mat <- matrix("", maxrow, maxcol)
agent_mat <- matpaste("<div id = \"agnt_", row(agent_mat), "_", col(agent_mat), "\"></div>", sep = "")
htmlTable(agent_mat, css.table = "width: 100%; padding: 0em; font-size: 30px; border: 2px; bordercolor: \"white\";", title = "rrr", label = "agnt_tab")
```

## Key Master

```{r, echo = FALSE, results = 'asis'}
key_mat <- matpaste("<div id = \"key_", row(agent_mat), "_", col(agent_mat), "\"></div>", sep = "")
key_mat <- matpaste("<table><tr><td width = 100%><div id = \"key_", row(agent_mat), "_", col(agent_mat), 
                    "\"></div></td><td width = 20px><output id = \"crd_", row(agent_mat), "_", col(agent_mat), "\"></output></td></tr></table>", 
                    sep = "")
htmlTable(key_mat, css.table = "width: 100%; padding: 0em; font-size: 30px;", css.cell = "margin: 2px; bordercolor: white;", title = "rrr", label = "key_tab")
```

## Settings

```{r, echo = FALSE, results = 'asis'}
cols <- c("Red", "Blue", "Green", "Yellow")
tab <- cbind(c("Rows:", "Columns:", "Words:", paste(cols, "Agents:"), "Assassins:"), 
             paste0("<input id = \"", c("rw", "cl", "sz", "rd", "bu", "gr", "ye", "as"), 
                    "\" type = \"number\" value = ", c(5, 5, 25, 9, 8, 0, 0, 1), 
                    " min = 0 max = ", c(10, 10, 100, 25, 25, 25, 25, 50), ">") )
tab[3, 2] <- paste0("<output id = \"sz\">25</output>")
cat(paste0("<form onsubmit = \"return false\" oninput = \"checkSettings()\">\n",
    htmlTable(tab, rnames = F, rgroup = c("Grid", "Agents"), n.rgroup = c(3, 5), align = "r", css.cell = "padding-left: 3em; padding-right: 3em;"),
    "</form>" ))

## This isn't going to change anything. I need to create a new function that is activated by the dropdown menu.
# cat(html_dropdown("wrdlist", c(orig = "Original", duet = "Duet", both = "Original + Duet", more = "Other", all = "All Words")))
cat(html_dropdown("wrdlist", c(Original = "orig", Duet = "duet", "Original + Duet" = "both", Other = "more", "All Words" = "all")))

```

<script>
checkSettings();
</script>

